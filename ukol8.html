<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sametová bojovka - Úkol 8: Citáty</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .line { 
            margin: 18px 0; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            flex-wrap: wrap; 
        }
        .blanks { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
            align-items: center; 
            margin: 10px 0;
        }
        .blank-select { 
            min-width: 140px; 
            padding: 8px; 
            border-radius: 4px; 
            border: 1px solid #ccc; 
            background: #fff;
            font-size: 16px;
        }
        .check-btn { 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            border: 1px solid #1976d2; 
            background: #1976d2; 
            color: #fff;
            font-weight: bold;
            transition: all 0.3s;
        }
        .check-btn:hover:not([disabled]) {
            background: #1565c0;
            transform: translateY(-1px);
        }
        .check-btn[disabled] { 
            opacity: 0.5; 
            cursor: default; 
        }
        .checkmark { 
            color: #2e7d32; 
            font-weight: 800; 
            margin-left: 10px;
            font-size: 1.2em;
        }
        .hidden { 
            display: none; 
        }
        #feedback { 
            margin: 15px 0; 
            font-weight: 700; 
            padding: 10px;
            border-radius: 4px;
        }
        .feedback.success { 
            color: #1b5e20; 
            background-color: #e8f5e9;
            border-left: 4px solid #2e7d32;
        }
        .feedback.error { 
            color: #b71c1c; 
            background-color: #ffebee;
            border-left: 4px solid #c62828;
        }
        .task-instructions {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #1976d2;
        }
        @media (max-width: 600px) {
            .blank-select { 
                min-width: 100%;
                margin-bottom: 8px;
            }
            .line {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="hero">
            <div class="hero-content">
                <h1>ÚKOL 8: CITÁTY</h1>
                <div class="divider"></div>
            </div>
        </header>

        <main class="content">
            <div class="task-instructions">
                <h2>Dokonči slavné citáty</h2>
                <p>Vyplň jednotlivé mezery výběrem slov z nabídky. Po správné kombinaci na řádku se objeví zelený šek a odemkne se další řádek.</p>
            </div>

    <!-- Lines container -->
            <div id="quotes-wrapper">
                <!-- Lines will be generated here by script -->
            </div>

            <div id="feedback" role="status" aria-live="polite"></div>
        </main>

        <footer>
            <p>Pravda a láska musí zvítězit nad lží a nenávistí</p>
        </footer>
    </div>

    <script src="script.js"></script>
    <script>
    // -------------------------------------------
    // SEKCE PRO ÚPRAVU (ZDE upravte slovní nabídky a správné kombinace)
    // -------------------------------------------
    // Každý řádek je objekt { blanks: N, options: [...], correct: [...] }
    // - blanks: počet prázdných míst v řádku
    // - options: pole slov (řetězců), která budou v nabídce pro každé prázdné místo
    //            (stejné možnosti se použijí pro všechna pole řádku)
    // - correct: přesné hodnoty (pole délky 'blanks') které považujeme za správné
    //
    // POZNÁMKA: porovnání používá normalizaci (trim, odstranění diakritiky a interpunkce, velká písmena),
    // takže můžete zadat hodnoty s či bez diakritiky.
    //
    // Upravit zde:
    const LINES = [
      // řádek 1: 9 mezer
      {
        blanks: 9,
        options: ['láska','a','Pravda','nad','zvítězit','komunistická','lží','sametová','nenávistí.','musí','prohrát'],
        correct: ['Pravda','a','láska','musí','zvítězit','nad','lží','a','nenávistí.'] // příklad: pokud řádek skutečně obsahuje 9 mezer, doplňte správné položky; prázdný řetězec = akceptuje libovolné (nebo změňte podle potřeby)
      },
      // řádek 2: 8 mezer
      {
        blanks: 8,
        options: ['si','musí','nedává,','svobodu','se','člověk','získat.','Svoboda'],
        correct: ['Svoboda','se','nedává,','svobodu','si','člověk','musí','získat.'] // upravte
      },
      // řádek 3: 5 mezer
      {
        blanks: 5,
        options: ['proces.','Demokracie','stav,','ale','Měna','není'],
        correct: ['Demokracie','není','stav,','ale','proces.'] // upravte
      },
      // řádek 4: 11 mezer
      {
        blanks: 11,
        options: ['jsou','kteří','chtějí','svobodu,','jsou','nést','ochotni','odpovědnost.','lidé,','Lidé,'],
        correct: ['Lidé,','kteří','chtějí','svobodu,','jsou','lidé,','kteří','jsou','ochotni','nést','odpovědnost.'] // upravte
      },
      // řádek 5: 12 mezer
      {
        blanks: 12,
        options: ['lidé','spojují','síla','zastavit.','pro','je','dobro,','společné','žádná','Když','nemůže','se'],
        correct: ['Když','se','lidé','spojují','pro','společné','dobro,','žádná','síla','je','nemůže','zastavit.'] // upravte
      },
      // řádek 6: 12 mezer
      {
        blanks: 12,
        options: ['činech.','Odvaha','rozhodnutích,','se','ne','malých','v','ve','velkých','projevuje','každodenních','jen'],
        correct: ['Odvaha','se','projevuje','v','malých','každodenních','rozhodnutích,','ne','jen','ve','velkých','činech.'] // upravte
      },
      // řádek 7: 12 mezer
      {
        blanks: 12,
        options: ['hodnotami.','síla','schopnosti','člověka','s','spočívá','Největší','vlastními','v','ve','jednat','souladu'],
        correct: ['Největší','síla','člověka','spočívá','ve','schopnosti','jednat','v','souladu','s','vlastními','hodnotami.'] // upravte
      },
    ];
    // -------------------------------------------
    // Konec sekce pro úpravu
    // -------------------------------------------
    
    // Inicializace časomíry
    document.addEventListener('DOMContentLoaded', function() {
        // Spustí časomíru, pokud ještě neběží
        if (typeof startTimer === 'function' && !window.timerStarted) {
            startTimer();
        }
    });

    // další konfigurace
    const TASK_NUMBER = 8;           // číslo úkolu (nechte 8 pokud odpovídá ukol8.html)
    const CHARS_FOR_TASK = 'AB';     // znak(y) které se uloží po splnění

    // pomocná normalizace (odstraní diakritiku, interpunkci; použito pro porovnání)
    function normalizeForCompare(s) {
      return String(s || '')
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/[^A-Z0-9 ]/ig, '')
        .replace(/\s+/g, ' ')
        .trim()
        .toUpperCase();
    }

    // Vytvoření HTML pro řádky
    function renderLines() {
      const wrapper = document.getElementById('quotes-wrapper');
      wrapper.innerHTML = '';
      LINES.forEach((line, idx) => {
        const lineEl = document.createElement('div');
        lineEl.className = 'line';
        lineEl.dataset.index = idx;

        // id pro odkazování
        const rowId = 'line-' + (idx+1);

        // container blanks
        const blanksContainer = document.createElement('div');
        blanksContainer.className = 'blanks';
        blanksContainer.id = rowId + '-blanks';

        for (let i=0;i<line.blanks;i++) {
          const sel = document.createElement('select');
          sel.className = 'blank-select';
          sel.dataset.pos = i;
          sel.id = `${rowId}-sel-${i}`;

          // prázdná volba
          const emptyOpt = document.createElement('option');
          emptyOpt.value = '';
          emptyOpt.textContent = '---';
          sel.appendChild(emptyOpt);

          line.options.forEach(opt => {
            const o = document.createElement('option');
            o.value = opt;
            o.textContent = opt;
            sel.appendChild(o);
          });

          // pokud řádek není odemčený, zakážeme selects kromě prvního řádku
          sel.disabled = (idx !== 0); // jen první řádek je aktivní na začátku
          blanksContainer.appendChild(sel);
        }

        // tlačítko pro kontrolu tohoto řádku
        const checkBtn = document.createElement('button');
        checkBtn.className = 'check-btn';
        checkBtn.id = rowId + '-check';
        checkBtn.textContent = 'Zkontrolovat';
        checkBtn.disabled = (idx !== 0); // jen pro aktivní řádek

        // šek (zobrazí se při správném vyplnění)
        const checkMark = document.createElement('span');
        checkMark.className = 'checkmark hidden';
        checkMark.id = rowId + '-ok';
        checkMark.textContent = '✔';

        // přidej do řádku
        lineEl.appendChild(blanksContainer);
        lineEl.appendChild(checkBtn);
        lineEl.appendChild(checkMark);

        wrapper.appendChild(lineEl);

        // bind event
        checkBtn.addEventListener('click', () => { checkLine(idx); });
      });
    }

    // ověří jeden řádek
    function checkLine(index) {
      const line = LINES[index];
      const rowId = 'line-' + (index+1);
      const selects = Array.from(document.querySelectorAll('#' + rowId + '-blanks select'));
      const chosen = selects.map(s => s.value || '');
      const feedback = document.getElementById('feedback');

      // Porovnání: pokud v 'correct' pole je prázdný string, interpretujeme to jako "akceptuj cokoliv" pro danou pozici.
      let ok = true;
      for (let i=0;i<line.blanks;i++) {
        const expected = (line.correct && line.correct[i] !== undefined) ? line.correct[i] : '';
        if (expected === '') {
          // akceptujeme cokoliv (ale pokud chcete, můžete to zrušit a udělat přesnou kontrolu)
          continue;
        }
        if (normalizeForCompare(chosen[i]) !== normalizeForCompare(expected)) {
          ok = false; break;
        }
      }

      if (ok) {
        // zobrazit checkmark
        document.getElementById(rowId + '-ok').classList.remove('hidden');
        document.getElementById(rowId + '-check').disabled = true;

        // deaktivovat selects v tomto řádku (ponecháme hodnoty)
        selects.forEach(s => { s.disabled = true; });

        // odemknout další řádek (pokud existuje)
        const nextIndex = index + 1;
        if (nextIndex < LINES.length) {
          // enable selects a check tlačítko u dalšího řádku
          const nextSelects = Array.from(document.querySelectorAll('#line-' + (nextIndex+1) + '-blanks select'));
          nextSelects.forEach(s => { s.disabled = false; });
          document.getElementById('line-' + (nextIndex+1) + '-check').disabled = false;
          feedback.textContent = '';
          feedback.className = '';
        } else {
          // poslední řádek správně - úkol hotov
          feedback.textContent = 'Gratuluji — všech 7 řádků vyplněno správně!';
          feedback.className = 'feedback success';
          // označíme úkol jako splněný (uložení kompatibilní se script.js)
          quotes_markTaskComplete();
        }
      } else {
        feedback.textContent = 'Nesprávně — zkuste to znovu na tomto řádku.';
        feedback.className = 'feedback error';
      }
    }

    // uloží do localStorage (kompatibilně se script.js)
    function quotes_markTaskComplete() {
      const completed = JSON.parse(localStorage.getItem('completedTasks') || '[]');
      if (!completed.includes(TASK_NUMBER)) {
        completed.push(TASK_NUMBER);
        localStorage.setItem('completedTasks', JSON.stringify(completed));
      }
      const collectedChars = JSON.parse(localStorage.getItem('collectedChars') || '{}');
      collectedChars[TASK_NUMBER] = CHARS_FOR_TASK;
      localStorage.setItem('collectedChars', JSON.stringify(collectedChars));

      // zavolat updateProgress pokud je k dispozici ve script.js
      if (typeof updateProgress === 'function') {
        try { updateProgress(); } catch (e) { console.warn('updateProgress() selhalo', e); }
      }
    }

    // init
    document.addEventListener('DOMContentLoaded', () => {
      renderLines();
      // pokud byl úkol už splněn dříve, zobrazíme jako splněný
      const completed = JSON.parse(localStorage.getItem('completedTasks') || '[]');
      if (completed.includes(TASK_NUMBER)) {
        // nastavit všechny řádky jako hotové (vizuálně)
        for (let i=0;i<LINES.length;i++) {
          const rowId = 'line-' + (i+1);
          const selects = Array.from(document.querySelectorAll('#' + rowId + '-blanks select'));
          selects.forEach(s => { s.disabled = true; });
          const checkBtn = document.getElementById(rowId + '-check');
          if (checkBtn) checkBtn.disabled = true;
          const ok = document.getElementById(rowId + '-ok');
          if (ok) ok.classList.remove('hidden');
        }
        const fb = document.getElementById('feedback');
        fb.textContent = 'Tento úkol byl již dříve splněn.';
        fb.className = 'feedback success';
      }
    });
  </script>
</body>
</html>
