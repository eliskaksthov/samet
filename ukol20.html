<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ãškol 2 â€” SametovÃ¡ Å¡ifra</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>

  <style>
    /* Simple styles for the inserted image and feedback */
    .task-figure {
      margin: 14px 0;
      text-align: center;
    }
    .task-image {
      max-width: 100%;
      height: auto;
      display: inline-block;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .task-caption {
      font-size: 0.95rem;
      color: #666;
      margin-top: 6px;
    }
    #feedback {
      font-weight: 600;
      margin-top: 10px;
    }
    .feedback .success { color: #0a0; }
    .feedback .error   { color: #c00; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Ãškol 2</h2>

    <!-- ObrÃ¡zek Ãºkolu: uloÅ¾te do repozitÃ¡Å™e napÅ™. images/ukol20.jpg a/nebo zmÄ›Åˆte src -->
    <figure class="task-figure" aria-hidden="false">
      <img src="images/ukol20.jpg" alt="Ãškol 2 â€” Å¡ifra (ilustraÄnÃ­ obrÃ¡zek)" class="task-image" loading="lazy">
      <figcaption class="task-caption">Tady Å¡ifra i obrÃ¡zek.</figcaption>
    </figure>

    <p><!-- Sem vloÅ¾ zadÃ¡nÃ­ Ãºkolu tÃ½kajÃ­cÃ­ se SametovÃ© revoluce. --></p>
    <p class="note">VyÅ™eÅ¡ Å¡ifru.</p>

    <!-- Input for player's answer -->
    <input type="text" id="answer" placeholder="Zadejte odpovÄ›Ä">

    <div style="margin-top:10px;">
      <!-- Button calls a local wrapper (we DO NOT modify script.js) -->
      <button onclick="submitUkol20()">Odeslat</button>
    </div>

    <p id="feedback" role="status" aria-live="polite"></p>

    <div class="footer">SprÃ¡vnÃ¡ odpovÄ›Ä (doÄasnÃ¡): <strong id="answer-reveal">********</strong></div>
  </div>

  <script>
    // --- KONFIGURACE: zde nastavte oÄekÃ¡vanou odpovÄ›Ä pro tento Ãºkol (pouze v tomto souboru) ---
    const EXPECTED_ANSWER = 'VCERA BYLA SAMETOVA REVOLUCE.'; // pÅ™esnÄ› ta frÃ¡ze, kterou chcete akceptovat

    // JakÃ© znaky za Ãºkol zÃ­skÃ¡ hrÃ¡Ä (uloÅ¾Ã­ se do collectedChars pro pÅ™ehled finÃ¡le).
    // Nastavte podle potÅ™eby (napÅ™. 'A', 'B', 'C' nebo vÃ­c znakÅ¯). Pokud Å¾Ã¡dnÃ©, pouÅ¾ijte '__'.
    const CHARS_FOR_TASK = '__';

    // ÄŒÃ­slo tohoto Ãºkolu v systÃ©mu (shodnÃ© se zbytkem aplikace)
    const TASK_NUMBER = 20;

    // Normalizace pro porovnÃ¡nÃ­: odstranÃ­ diakritiku, odstranÃ­ interpunkci kromÄ› pÃ­smen a ÄÃ­slic,
    // slouÄÃ­ mezery a pÅ™epne na velkÃ¡ pÃ­smena â€” tÃ­m povolÃ­me rÅ¯znÃ© varianty zÃ¡pisu uÅ¾ivatele.
    function normalizeForCompare(s) {
      return String(s || '')
        .normalize('NFD')                    // rozloÅ¾Ã­ znaky s diakritikou
        .replace(/[\u0300-\u036f]/g, '')     // smaÅ¾e diakritiku
        .replace(/[^A-Z0-9 ]/ig, '')         // smaÅ¾e interpunkci a speciÃ¡lnÃ­ znaky (nechÃ¡ pÃ­smena, ÄÃ­sla, mezery)
        .replace(/\s+/g, ' ')                // slouÄÃ­ opakovanÃ© mezery
        .trim()
        .toUpperCase();
    }

    // LokÃ¡lnÃ­ wrapper pro odeslÃ¡nÃ­ odpovÄ›di â€” NEZASAHUJE do script.js, mÃ­sto toho
    // aplikuje normalizaci a provede stejnÃ© kroky, kterÃ© dÄ›lÃ¡ checkAnswer ve script.js:
    // - ukÃ¡Å¾e feedback
    // - uloÅ¾Ã­ completedTasks a collectedChars do localStorage
    // - zavolÃ¡ updateProgress() (funkce je v script.js, takÅ¾e ji mÅ¯Å¾eme pouÅ¾Ã­t)
    // - pÅ™esmÄ›ruje na dalÅ¡Ã­ strÃ¡nku, pokud je odpovÄ›Ä sprÃ¡vnÃ¡
    function submitUkol20() {
      const inputEl = document.getElementById('answer');
      const feedbackEl = document.getElementById('feedback');
      const userRaw = (inputEl.value || '');

      // porovnÃ¡nÃ­ normalizovanÃ© formy
      if (normalizeForCompare(userRaw) === normalizeForCompare(EXPECTED_ANSWER)) {
        // SprÃ¡vnÄ› â€” zobrazÃ­me stejnou strukturu jako script.js
        feedbackEl.innerHTML = `
          <div class="success">
            âœ… <strong>SprÃ¡vnÄ›!</strong><br>
            ZÃ­skanÃ© znaky: <span class="chars">${CHARS_FOR_TASK}</span><br><br>
            ğŸ“ <strong>NÃ¡povÄ›da na dalÅ¡Ã­ QR kÃ³d:</strong><br>
            (Å½Ã¡dnÃ¡ nenÃ­ :))
          </div>
        `;
        feedbackEl.className = 'feedback success';

        // UloÅ¾it splnÄ›nÃ½ Ãºkol do localStorage (stejnÃ½ formÃ¡t jako script.js)
        const completed = JSON.parse(localStorage.getItem('completedTasks') || '[]');
        if (!completed.includes(TASK_NUMBER)) {
          completed.push(TASK_NUMBER);
          localStorage.setItem('completedTasks', JSON.stringify(completed));
        }

        // UloÅ¾it zÃ­skanÃ© znaky
        const collectedChars = JSON.parse(localStorage.getItem('collectedChars') || '{}');
        collectedChars[TASK_NUMBER] = CHARS_FOR_TASK;
        localStorage.setItem('collectedChars', JSON.stringify(collectedChars));

        // Aktualizovat progress (funkce updateProgress je definovanÃ¡ v script.js)
        if (typeof updateProgress === 'function') {
          try { updateProgress(); } catch (e) { console.warn('updateProgress() failed', e); }
        }

        // Pokud jsou splnÄ›ny vÅ¡echny Ãºkoly, nechÃ¡me script.js upozornit (pokud to chceÅ¡,
        // mÅ¯Å¾eÅ¡ ponechat i vlastnÃ­ alert zde). Tady redirect s krÃ¡tkÃ½m zpoÅ¾dÄ›nÃ­m:
        setTimeout(() => {
          window.location.href = next;
        }, 1200);

      } else {
        // NesprÃ¡vnÄ›
        feedbackEl.innerHTML = `
          <div class="error">
            âŒ <strong>NesprÃ¡vnÄ›.</strong> Zkus to znovu!
          </div>
        `;
        feedbackEl.className = 'feedback error';
      }
    }

    // Podpora klÃ¡vesy Enter
    document.getElementById('answer').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        submitUkol20('ukol3.html');
      }
    });

    // VolitelnÄ›: bÄ›hem testovÃ¡nÃ­ zobrazÃ­me sprÃ¡vnou odpovÄ›Ä v patiÄce (odkomentujte pokud chcete)
    // document.getElementById('answer-reveal').textContent = EXPECTED_ANSWER;
  </script>
</body>
</html>
